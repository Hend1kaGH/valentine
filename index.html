<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Spesial untuk mu</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #ff6b9d;
      --secondary: #ffb3c6;
      --accent: #ff4d6d;
      --text-dark: #5a5a5a;
      --shadow: 0 8px 24px rgba(255, 107, 157, 0.25);
    }

    body {
      font-family: 'Poppins', system-ui, sans-serif;
      min-height: 100vh;
      overflow: hidden;
      background: linear-gradient(135deg, #fff5f7, #ffe6ee);
      color: var(--text-dark);
      position: relative;
    }

    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 1;
    }

    /* ===== PAGE 1: GIFT ===== */
    #page-gift {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      flex-direction: column;
      padding: 20px;
      position: relative;
      z-index: 10;
    }

    .music-control {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 48px;
      height: 48px;
      border-radius: 16px;
      background: white;
      border: 2px solid var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 20;
      transition: all 0.3s ease;
      box-shadow: var(--shadow);
    }

    .music-control:hover {
      transform: scale(1.1);
      background: var(--primary);
      color: white;
    }

    .music-playing i {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .gift-container {
      position: relative;
      margin-bottom: 30px;
      cursor: pointer;
      transition: transform 0.4s ease;
      z-index: 15;
      pointer-events: auto;
    }

    .gift-container:hover {
      transform: scale(1.05);
    }

    .gift-box {
      width: 220px;
      height: 220px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .gift-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 40%;
      background: rgba(255, 255, 255, 0.3);
      transform: skewY(-3deg);
    }

    .gift-box::after {
      content: 'üéÅ';
      font-size: 80px;
      position: relative;
      z-index: 2;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }

    .ribbon {
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 60px;
      background: var(--secondary);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(255, 107, 157, 0.4);
    }

    .hint {
      margin-top: 24px;
      font-size: 18px;
      font-weight: 600;
      background: white;
      padding: 14px 32px;
      border-radius: 50px;
      border: 2px solid var(--primary);
      letter-spacing: 0.5px;
      max-width: 90%;
      box-shadow: 0 4px 16px rgba(255, 107, 157, 0.2);
      transition: all 0.3s ease;
      color: var(--accent);
    }

    .hint:hover {
      background: var(--primary);
      color: white;
      transform: scale(1.03);
    }

    /* ===== PAGE 2: CHAT ===== */
    #page-chat {
      display: none;
      height: 100vh;
      flex-direction: column;
      position: relative;
      z-index: 10;
    }

    .chat-header {
      background: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      position: relative;
      border-bottom: 2px solid var(--secondary);
      box-shadow: 0 4px 12px rgba(255, 107, 157, 0.1);
    }

    .status-dot {
      width: 12px;
      height: 12px;
      background: #4ade80;
      border-radius: 50%;
      position: absolute;
      right: 20px;
      box-shadow: 0 0 8px #4ade80;
    }

    .chat-name {
      font-weight: 700;
      font-size: 18px;
      font-family: 'Dancing Script', cursive;
      color: var(--accent);
    }

    .chat-subtitle {
      font-size: 13px;
      color: var(--text-dark);
      opacity: 0.8;
      margin-top: 2px;
    }

    .chat-messages {
      flex: 1;
      padding: 24px 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23ffb3c6" fill-opacity="0.05" d="M0,0 L100,0 L100,100 L0,100 Z"/></svg>');
    }

    .message {
      max-width: 80%;
      padding: 14px 18px;
      border-radius: 20px;
      line-height: 1.5;
      position: relative;
      font-size: 16px;
      word-wrap: break-word;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .from-other {
      background: white;
      align-self: flex-start;
      border: 1px solid var(--secondary);
      border-bottom-left-radius: 6px;
      color: var(--text-dark);
    }

    .from-user {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      align-self: flex-end;
      border-bottom-right-radius: 6px;
      color: white;
      box-shadow: 0 4px 16px rgba(255, 107, 157, 0.3);
    }

    /* ‚úÖ TYPING INDICATOR (UNTUK SEMUA PESAN) */
    .typing-indicator {
      align-self: flex-start;
      background: white;
      border: 1px solid var(--secondary);
      border-radius: 20px;
      padding: 14px 20px;
      display: flex;
      gap: 4px;
      width: fit-content;
      margin-top: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: var(--primary);
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }

    .input-area {
      padding: 16px;
      background: white;
      display: flex;
      gap: 12px;
      border-top: 2px solid var(--secondary);
      position: relative;
    }

    .input-area textarea {
      flex: 1;
      background: white;
      border: 2px solid var(--secondary);
      border-radius: 24px;
      padding: 14px 20px;
      resize: none;
      font-family: 'Poppins', sans-serif;
      color: var(--text-dark);
      font-size: 16px;
      height: 50px;
      outline: none;
      transition: all 0.3s ease;
    }

    .input-area textarea::placeholder {
      color: #b0b0b0;
    }

    .input-area textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.2);
    }

    .send-btn {
      width: 52px;
      height: 52px;
      border-radius: 26px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      border: none;
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-shrink: 0;
      box-shadow: var(--shadow);
    }

    .send-btn:hover {
      transform: scale(1.08);
      box-shadow: 0 6px 20px rgba(255, 107, 157, 0.4);
    }

    .send-btn:active {
      transform: scale(0.95);
    }

    /* ‚úÖ ICON KIRIM MENGHADAP KE KANAN! */
    .send-btn i {
      font-size: 18px;
      transform: rotate(0deg);
      transition: transform 0.3s ease;
    }

    .send-btn:hover i {
      transform: translateX(2px);
    }

    @media (max-width: 600px) {
      .gift-box { width: 180px; height: 180px; }
      .gift-box::after { font-size: 60px; }
      .hint { font-size: 16px; padding: 12px 24px; }
      .message { max-width: 88%; padding: 12px 16px; font-size: 15px; }
      .chat-name { font-size: 17px; }
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <!-- PAGE 1: GIFT -->
  <div id="page-gift">
    <div class="music-control" id="musicToggle">
      <i class="fas fa-music"></i>
    </div>
    <div class="gift-container" id="giftBox">
      <div class="gift-box">
        <div class="ribbon"></div>
      </div>
    </div>
    <div class="hint">klik hadiah ini buat buka pesan spesial dari aku</div>
  </div>

  <!-- PAGE 2: CHAT -->
  <div id="page-chat">
    <div class="chat-header">
      <div style="font-size: 28px; color: var(--accent);">üòä</div>
      <div>
        <div class="chat-name">Damian</div>
        <div class="chat-subtitle">online</div>
      </div>
      <div class="status-dot"></div>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="input-area">
      <textarea id="userMessage" placeholder="tulis sesuatu yang manis..."></textarea>
      <button class="send-btn" id="sendBtn">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <!-- Audio -->
  <audio id="bgMusic" loop>
    <source src="https://assets.mixkit.co/music/preview/mixkit-romantic-sunset-687.mp3" type="audio/mpeg">
  </audio>
  <audio id="popSound">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-click-2649.mp3" type="audio/mpeg">
  </audio>

  <!-- Particles.js -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script>
    // Particles config
    particlesJS('particles-js', {
      particles: {
        number: { value: 60, density: { enable: true, value_area: 800 } },
        color: { value: "#ff6b9d" },
        shape: { type: "circle" },
        opacity: { value: 0.3, random: true },
        size: { value: 2, random: true },
        line_linked: {
          enable: true,
          distance: 150,
          color: "#ffb3c6",
          opacity: 0.2,
          width: 1
        },
        move: {
          enable: true,
          speed: 1.5,
          direction: "none",
          random: false,
          straight: false,
          out_mode: "out",
          bounce: false
        }
      },
      interactivity: {
        detect_on: "canvas",
        events: {
          onhover: { enable: true, mode: "grab" },
          onclick: { enable: true, mode: "push" },
          resize: true
        }
      },
      retina_detect: true
    });

    const messages = [
      "hei kamu...",
      "ada yang pengen kasih ucapan",
      "Makasih ya sudah nemenin aku main roblox selama ini",
      "Maaf jika hadianya kurang bagus, kemarin aku mau nambahin fotomu tapi kamu kirimnya sekali lihat terus...",
      "Dan aku gak tahu lagi mau ngomong apa",
      "Selamat hari valentine :)"
    ];

    const pageGift = document.getElementById('page-gift');
    const pageChat = document.getElementById('page-chat');
    const chatMessages = document.getElementById('chatMessages');
    const giftBox = document.getElementById('giftBox');
    const bgMusic = document.getElementById('bgMusic');
    const popSound = document.getElementById('popSound');
    const musicToggle = document.getElementById('musicToggle');
    const sendBtn = document.getElementById('sendBtn');
    const userMessage = document.getElementById('userMessage');

    let msgIndex = 0;
    let isPlaying = false;
    let currentTypingIndicator = null;

    // Music toggle
    musicToggle.addEventListener('click', () => {
      if (isPlaying) {
        bgMusic.pause();
        musicToggle.classList.remove('music-playing');
        musicToggle.style.background = 'white';
        musicToggle.style.color = 'var(--primary)';
      } else {
        bgMusic.play().catch(() => {});
        musicToggle.classList.add('music-playing');
        musicToggle.style.background = 'var(--primary)';
        musicToggle.style.color = 'white';
      }
      isPlaying = !isPlaying;
    });

    // Gift click
    giftBox.addEventListener('click', () => {
      popSound.play();
      pageGift.style.display = 'none';
      pageChat.style.display = 'flex';
      window.location.hash = 'chat';
      
      if (!isPlaying) {
        bgMusic.play().then(() => {
          isPlaying = true;
          musicToggle.classList.add('music-playing');
          musicToggle.style.background = 'var(--primary)';
          musicToggle.style.color = 'white';
        }).catch(e => console.log("Autoplay needs gesture"));
      }
      
      showNextMessage();
    });

    // ‚úÖ FUNGSI UTAMA: TAMPILKAN PESAN DENGAN EFEK TYPING
    function showNextMessage() {
      if (msgIndex >= messages.length) {
        // Pesan terakhir setelah semua selesai
        showTypingIndicator();
        setTimeout(() => {
          hideTypingIndicator();
          addMessage("klik tombol pesawat buat balas aku ya... nanti langsung ke WA aku üí¨üíï", false);
        }, 2200);
        return;
      }

      // Tampilkan typing indicator dulu
      showTypingIndicator();
      
      // Delay acak sebelum mulai mengetik
      const thinkingDelay = 800 + Math.random() * 1000;
      setTimeout(() => {
        hideTypingIndicator();
        
        // Buat elemen pesan kosong
        const msgDiv = document.createElement('div');
        msgDiv.className = 'message from-other';
        msgDiv.textContent = ''; // Mulai dari kosong
        chatMessages.appendChild(msgDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Ketik karakter per karakter
        typeText(messages[msgIndex], msgDiv, () => {
          msgIndex++;
          // Delay sebelum pesan berikutnya
          setTimeout(showNextMessage, 500);
        });
      }, thinkingDelay);
    }

    // ‚úÖ TAMPILKAN TYPING INDICATOR
    function showTypingIndicator() {
      currentTypingIndicator = document.createElement('div');
      currentTypingIndicator.className = 'typing-indicator';
      currentTypingIndicator.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      `;
      chatMessages.appendChild(currentTypingIndicator);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // ‚úÖ SEMBUNYIKAN TYPING INDICATOR
    function hideTypingIndicator() {
      if (currentTypingIndicator) {
        currentTypingIndicator.remove();
        currentTypingIndicator = null;
      }
    }

    // ‚úÖ FUNGSI MENGETIK PER KARAKTER
    function typeText(text, element, callback) {
      let i = 0;
      const speed = 30 + Math.random() * 40; // Kecepatan acak (30-70ms)
      
      function type() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          i++;
          chatMessages.scrollTop = chatMessages.scrollHeight;
          setTimeout(type, speed);
        } else {
          // Mainkan suara saat selesai mengetik
          popSound.volume = 0.3;
          popSound.play().catch(() => {});
          if (callback) callback();
        }
      }
      
      type();
    }

    function addMessage(text, isUser = false) {
      popSound.volume = 0.3;
      popSound.play();
      
      const msgDiv = document.createElement('div');
      msgDiv.className = `message ${isUser ? 'from-user' : 'from-other'}`;
      msgDiv.textContent = text;
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function sendReply() {
  const text = userMessage.value.trim();
  if (!text) {
    userMessage.placeholder = "jangan kosong dong üò¢ tulis sesuatu...";
    userMessage.style.borderColor = 'var(--accent)';
    setTimeout(() => {
      userMessage.style.borderColor = 'var(--secondary)';
      userMessage.placeholder = "tulis sesuatu yang manis...";
    }, 2000);
    return;
  }

  addMessage(text, true);
  userMessage.value = '';
  
  // ‚úÖ HAPUS SPASI DI SINI! (INI PENYEBAB ERROR DI HP)
  const encoded = encodeURIComponent(`Hai damian\n\nAku mau ngomong sesuatu "${text}"`);
  const whatsappUrl = `https://wa.me/6285191240359?text=${encoded}`;
  
  // ‚úÖ SOLUSI HP: COBA POPUP ‚Üí FALBACK KE REDIRECT
  try {
    const newWindow = window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
      throw new Error('Popup blocked');
    }
    // Tambah pesan sukses setelah 1 detik
    setTimeout(() => {
      addMessage("üíå pesan kamu udah terkirim ke WA aku!", false);
    }, 1000);
  } catch (e) {
    // Redirect penuh jika popup gagal (umum di HP)
    window.location.href = whatsappUrl;
  }
}

    sendBtn.addEventListener('click', sendReply);
    userMessage.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendReply();
      }
    });

    if (window.innerWidth > 768) userMessage.focus();

    if (window.location.hash === '#chat') {
      pageGift.style.display = 'none';
      pageChat.style.display = 'flex';
      setTimeout(showNextMessage, 500);
    }
  </script>
</body>
</html>